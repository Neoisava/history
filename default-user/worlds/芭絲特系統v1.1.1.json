{
    "entries": {
        "2": {
            "uid": 2,
            "key": [],
            "keysecondary": [],
            "comment": "è¼¸å‡ºè¦ç¯„",
            "content": "<status_format_example>\nç»å¯¹è§„åˆ™:\n- statustextæ˜¯æœ€å¾Œå¿…å®šè¼¸å‡ºçš„æ–‡æœ¬ï¼Œè‹¥ä¸Šä¸‹æ–‡æœ‰å…¶ä»–çš„ç‹€æ…‹æ¬„è¦å‰‡ï¼Œä¹Ÿå¿…é ˆéµå®ˆä¸¦è¼¸å‡º\n- å…¶è¾“å‡ºå¿…é¡»ä¸¥æ ¼éµå¾ªXMLæ ¼å¼ï¼Œä»¥<statustext>å¼€å§‹ï¼Œä»¥</statustext>ç»“æŸ\n- æ¯ä¸ªå¥³æ€§è§’è‰²å¿…é¡»åŒ…å«å®Œæ•´çš„æ ‡ç­¾å¯¹\n- èº«é«˜å’Œé«”é‡è¼¸å‡ºæ•¸å­—+å–®ä½; è…°è‡€åœæ˜¯æ•¸å­—ï¼Œè€Œèƒ¸åœæ˜¯æ•¸å­—(ç½©æ¯)ï¼Œç¦æ­¢è¼¸å‡ºæ–‡å­—å½¢å®¹è©\n- <character>ä»…åœ¨è©²è§’è‰²åœ¨å ´æ™¯æ—¶è¾“å‡º\n- æè¿°æ€§æ–‡æœ¬å¿…é¡»åŸºäºè§’è‰²çš„å®é™…ç”Ÿç†çŠ¶æ€\n- <reproduction>ä¸‹ï¼Œç²¾å­ã€åµå­ç”¨æ–¼æœˆç¶“; èƒæ•°ã€çˆ¶äº²ã€å¥åº·ã€ä¾›å…»ã€ååº”ç”¨æ–¼å¦Šå¨ èˆ‡åˆ†å¨©ï¼Œè‹¥è©²éšæ®µæ¬„ä½ä¸é©ç”¨è¼¸å‡ºN/A\n- ä½¿ç”¨å‰æ–‡æ‰€æåŠçš„æ™‚é–“æ ¼å¼ï¼Œè‹¥ç„¡é»˜èªyyyy-MM-dd HH:mm\n- ä½¿ç”¨å‰æ–‡æ‰€æåŠçš„åœ°é»æ ¼å¼ï¼Œè‹¥ç„¡é»˜èªå¤§å ´æ‰€ - å°å€åŸŸ\n- è‹¥æ•…äº‹ç™¼ç”Ÿåœ¨ç¾ä»£å¯«å¯¦ï¼Œç§æ—åªè¼¸å‡ºäººé¡\n- è‹¥ä¸»æ§è§’è‰²æ˜¯å¥³æ€§ï¼Œä¹Ÿéœ€è¼¸å‡ºå…¶<character>æ–‡æœ¬ï¼Œä¸èƒ½è¼¸å‡ºæœªçŸ¥\næ ¼å¼æ¨¡æ¿ï¼š\n<statustext>\n  <time>{time}</time>\n  <location>{location}</location>\n  <character>\n  <namestr>{char}</namestr>\n    <appearance>\n      ç§æ—|{race}\n      å¹´é¾„|{age}\n      èº«é«˜|{height}\n      ä½“é‡|{weight} \n      ä¸‰å›´|{bust}/{waist}/{hip}\n    </appearance>\n    <physiology>\n      éœ€æ±‚|{è§’è‰²çš„ç”Ÿç†éœ€æ±‚ï¼Œå¦‚é£¢é¤“/æ’æ³„/ç¡çœ ç­‰}\n      æ€§æ…¾|{æ€§æ…¾å€¼åŠç‹€æ…‹æè¿°}\n      å°ç©´|{æ ¹æ®å½“å‰ç”Ÿç†çŠ¶æ€æè¿°é˜´é“}\n      å­å®«|{å®®å£“å€¼å’Œæ ¹æ®å½“å‰ç”Ÿç†çŠ¶æ€æè¿°å­å®«ï¼Œè‹¥æ‡·å­•æ™‚é ˆå¤šæè¿°ç¾Šè†œ/ç¾Šæ°´}\n      èŠç©´|{æ ¹æ®å½“å‰ç”Ÿç†çŠ¶æ€æè¿°è‚›é—¨}\n      ç›´è…¸|{æ ¹æ®å½“å‰ç”Ÿç†çŠ¶æ€æè¿°ç›´è…¸}\n      ç—‡çŠ¶|{æœˆç»ã€å¦Šå¨ ã€åˆ†å¨©äºè§’è‰²ä¸Šçš„å½±å“}\n      ç‰¹è´¨|{éå…¸å‹èº«é«”æ€§è³ª}\n    </physiology>\n    <reproduction>\n      ç²¾å­|{å®«å†…æ€»ç²¾å­é‡å’Œæ¥æº}\n      åµå­|{å®«å†…åµå­æ•°é‡}\n      èƒæ•°|{æ€€èƒæ•°å’Œæ€§åˆ¥}\n      çˆ¶äº²|{ç²¾å­æ¥æº}\n      å¥åº·|{å¦Šå¨ å¥åº·å€¼åŠçŠ¶æ€æè¿°æƒ…å†µ}\n      ä¾›å…»|{èƒç›˜ã€åµé»„æˆ–å…¶ä»–ä¾›å…»æºçš„çŠ¶æ€æè¿°}\n      ååº”|{èƒå„¿ã€åµæˆ–å…¶ä»–ç±»èƒšä½“çš„çŠ¶æ€ã€ä½ç½®åŠæ´»åŠ¨æƒ…å†µ}\n    </reproduction>\n  </character>\n</statustext>\n\n</status_format_example>",
            "constant": true,
            "vectorized": false,
            "selective": true,
            "selectiveLogic": 0,
            "addMemo": true,
            "order": 200,
            "position": 4,
            "disable": false,
            "excludeRecursion": false,
            "preventRecursion": false,
            "delayUntilRecursion": false,
            "probability": 100,
            "useProbability": true,
            "depth": 0,
            "group": "",
            "groupOverride": false,
            "groupWeight": 100,
            "scanDepth": null,
            "caseSensitive": null,
            "matchWholeWords": null,
            "useGroupScoring": null,
            "automationId": "",
            "role": 0,
            "sticky": 0,
            "cooldown": 0,
            "delay": 0,
            "displayIndex": 2,
            "matchPersonaDescription": false,
            "matchCharacterDescription": false,
            "matchCharacterPersonality": false,
            "matchCharacterDepthPrompt": false,
            "matchScenario": false,
            "matchCreatorNotes": false
        },
        "3": {
            "uid": 3,
            "key": [],
            "keysecondary": [],
            "comment": "å‡½æ•°å£°æ˜",
            "content": "---\nä»¥ä¸‹æ˜¯å¯è°ƒç”¨çš„å‡½æ•°:\nfunction updateExperience(female: str, exp: {virginity: str, mate: str, latestSexPartner: str, relationshipExperience:int, sexExperience: int, pregnantExperience: int, birthExperience: int, miscarriageExperience: int}) //è¨­ç½®è§’è‰²æƒ…æ„Ÿä¸æ€§ç»éªŒ\nfunction addSperm(female: str, male: str, amount: int) // åœ¨è§’è‰²å­å®«å†…æ³¨å…¥ç²¾æ¶²(ml)\nfunction impregnate(female: str, male: str) // è®©å¥³æ€§è§’è‰²å—ç²¾\nfunction setMenstrualPhases(female: str, stage: 'åµæ³¡æœŸ'|'æ’åµæœŸ'|'é»„ä½“æœŸ'|'æœˆç»æœŸ') // è®¾ç½®/æ›´æ”¹è§’è‰²çš„æœˆç»å‘¨æœŸ\nfunction addEggs(female: str, amount: int) // è®©å¥³æ€§è§’è‰²æ’åµï¼Œä¸è«–æ˜¯å¦æ’åµæœŸ\nfunction setPregnantDirectly(female: str, male: str, n:int, pregnantDays:int) // è®©å¥³æ€§è§’è‰²æ‡·ä¸Šnå€‹å­©å­ï¼Œç¶“épregnantDayså¤©(å°å·²æ‡·å­•è€…ç„¡æ•ˆ)\nfunction endPregnancy(female: str, miscarriage: bool) // è®©è§’è‰²ç”Ÿç”¢æˆ–æµç”¢\nfunction adjustFetalPosition(female: str, fetusIndex: int, newPosition: 'å¾…å®š'|'é ­ä½'|'è‡€ä½'|'æ©«ä½'|'æ–œä½'|'ç³¾çº'|'æœªçŸ¥') //èª¿æ•´æŸä¸€èƒå…’çš„èƒä½\nfunction adjustMoodEmoji(female: str, fetusIndex: int, newMoodEmoji: str) //èª¿æ•´æŸä¸€èƒå…’çš„å¿ƒæƒ…emoji\nfunction adjustFetalBias(female: str, fetusIndex: int, newBias: float) //èª¿æ•´æŸä¸€èƒå…’çš„èƒé‡, å€¼åŸŸ[0.5, 2.0], 1.0ç‚ºå¹³è¡¡é»\nfunction passedTime(time: { day: int, hour: int, minute: int, week: int, month: int, year: int }) // æ—¶é—´æµé€å¤„ç†\nsetvar('bf.female.isHere',bool); //è©²å¥³æ€§è…³è‰²æ˜¯å¦åœ¨å ´\nsetvar('bf.female.libido', int); //èª¿æ•´å¥³æ€§è§’è‰²çš„æ€§æ…¾, å€¼åŸŸ[0, 100]\nsetvar('bf.female.uterinePressure', int); //èª¿æ•´å¥³æ€§è§’è‰²çš„å®«å£“, å€¼åŸŸ[0, 150], æœªå¦Šå¨ æ™‚æœ€é«˜25, å¦Šå¨ æ™‚éœ€ç ´80æ‰é–‹å§‹é€²å…¥ç”¢å‰é™£ç—›\nsetvar('bf.female.pregnancyHealth', int); //èª¿æ•´å¥³æ€§è§’è‰²çš„å¦Šå¨ å¥åº·(é¤Šåˆ†), å€¼åŸŸ[0, 200],100ç‚ºå¹³è¡¡é»\n\nä½¿ç”¨ä»¥ä¸‹æ ¼å¼è¿›è¡Œè°ƒç”¨:\n<%% function(arg1, arg2, ...) %%>\nä¾‹å¦‚:\n<%% updateExperience('{{char}}', {virginity: null}) %%> // null ç‚ºè©²è§’è‰²æ˜¯è™•å¥³\n<%% updateExperience('{{char}}', {virginity: null, mate: 'é–¨å¯†',relationshipExperience:1}) %%> // null ç‚ºè©²è§’è‰²æ˜¯è™•å¥³ï¼Œè€Œä¸”èˆ‡å‹äººç™¾åˆ\n<%% updateExperience('{{char}}', {virginity: '{{user}}', sexExperience: 1}) %%> //è¢«{{user}}å¥ªèµ°è™•å¥³\n<%% updateExperience('{{char}}', {virginity: 'é«˜ä¸­ç”·å‹', mate: 'ä¸ˆå¤«', latestSexPartner: 'å¥èº«æ•™ç·´',relationshipExperience:4, sexExperience: 25,pregnantExperience: 2, birthExperience: 0, miscarriageExperience: 1}) %%> //è©²è§’è‰²æƒ…å²è±å¯Œ\n<%% addSperm('{{char}}', '{{user}}',15) %%>\n<%% addSperm('{{char}}', 'å«–å®¢',-20) %%> // æ¸…æ½”å®®å…§ç²¾æ¶²\n<%% setMenstrualPhases('{{char}}', 'æ’åµæœŸ') %%>\n<%% setPregnantDirectly('{{char}}', '{{user}}', 2, 120) %%>\n<%- adjustFetalPosition('{{char}}',0,'è‡€ä½') %>\n<%- adjustFetalBias('{{char}}',1, 1.6) %>\n<%% adjustMoodEmoji('{{char}}', 0, 'ğŸ’¤') %%>\n<%% adjustMoodEmoji('{{char}}', 1, 'ğŸ’¢') %%> \n<%% adjustMoodEmoji('{{char}}', 2, 'ğŸ¥³') %%>\n<%% passedTime({ minute: 30 }) %%>\n<%% passedTime({ hour: 2 }) %%>\n<%% passedTime({ day: 1, hour: 3 }) %%>\n<%% setvar('bf.{{char}}.isHere', true); %%>\n<%% setvar('bf.{{char}}.libido', 55); %%>\n<%% setvar('bf.{{char}}.uterinePressure', 21); %%>\n<%% setvar('bf.{{char}}.pregnancyHealth', 102); %%>\næ³¨æ„ï¼šåœ¨æ°å½“æ—¶æœºè°ƒç”¨ç›¸åº”çš„å‡½æ•°ï¼ŒaddSpermä»…é™äºå­å®«ï¼Œå£äº¤ä¸ç®—ã€‚\n---",
            "constant": true,
            "vectorized": false,
            "selective": true,
            "selectiveLogic": 0,
            "addMemo": true,
            "order": 100,
            "position": 0,
            "disable": false,
            "excludeRecursion": false,
            "preventRecursion": false,
            "delayUntilRecursion": false,
            "probability": 100,
            "useProbability": true,
            "depth": 4,
            "group": "",
            "groupOverride": false,
            "groupWeight": 100,
            "scanDepth": null,
            "caseSensitive": null,
            "matchWholeWords": null,
            "useGroupScoring": null,
            "automationId": "",
            "role": null,
            "sticky": 0,
            "cooldown": 0,
            "delay": 0,
            "displayIndex": 3,
            "matchPersonaDescription": false,
            "matchCharacterDescription": false,
            "matchCharacterPersonality": false,
            "matchCharacterDepthPrompt": false,
            "matchScenario": false,
            "matchCreatorNotes": false
        },
        "4": {
            "uid": 4,
            "key": [],
            "keysecondary": [],
            "comment": "å‡½æ•°å®šä¹‰",
            "content": "<%\ndefine('menstrualStage', ['åµæ³¡æœŸ','æ’åµæœŸ','é»„ä½“æœŸ','æœˆç»æœŸ']);\ndefine('pregnancyStage', ['å­•æ—©æœŸ','å­•ä¸­æœŸ','å­•æ™šæœŸ','ä¸´äº§æœŸ','é€¾æœŸ']);\ndefine('laborStage', ['ç¬¬ä¸€äº§ç¨‹','ç¬¬äºŒäº§ç¨‹','ç¬¬ä¸‰äº§ç¨‹']);\ndefine('fetusPosition', ['å¾…å®š','é ­ä½','è‡€ä½','æ©«ä½','æ–œä½','ç³¾çº','æœªçŸ¥']);\nconst pregnancyStageDays = {\n    'å­•æ—©æœŸ': 84,\n    'å­•ä¸­æœŸ': 105,\n    'å­•æ™šæœŸ': 63,\n    'ä¸´äº§æœŸ': 28\n};\nconst menstrualStageDays = {\n    'åµæ³¡æœŸ': 9,\n    'æ’åµæœŸ': 2,\n    'é»„ä½“æœŸ': 12,\n    'æœˆç»æœŸ': 5\n};\nconst laborStageBaseHours={\n    'ç¬¬ä¸€äº§ç¨‹': 12,\n    'ç¬¬äºŒäº§ç¨‹': 2,\n    'ç¬¬ä¸‰äº§ç¨‹': 0.25\n};\nconst laborStageIncrement={\n    'ç¬¬ä¸€äº§ç¨‹': 1.5,\n    'ç¬¬äºŒäº§ç¨‹': 2,\n    'ç¬¬ä¸‰äº§ç¨‹': 0.25\n};\ndefine('notifyCycle', function(female, forced = false) {\n    if(this.variables?.bf?.[female] === null) return;\n    const stage = this.getvar(`bf.${female}.stage`);\n    const days = this.getvar(`bf.${female}.days`, { defaults: 1 });\n    const notifySecondary = this.getvar(`bf.${female}.notifySecondary`);\n    // æ€€å­•æœŸé—´çš„å¥åº·çŠ¶æ€æç¤º\n    if(pregnancyStage.includes(stage)) {\n        const pregnancyHealth = this.getvar(`bf.${female}.pregnancyHealth`, { defaults: 100 });\n        const uterinePressure = this.getvar(`bf.${female}.uterinePressure`, { defaults: 0 });\n\n        // æ£€æŸ¥pregnancyHealthçŠ¶æ€\n        if(pregnancyHealth < 70) {\n            this.setvar(`bf.${female}.notifySecondary`, `${female}çš„å¦Šå¨ çŠ¶æ€ä¸ç¨³ï¼Œå¯èƒ½å­˜åœ¨è¥å…»ä¸è¶³ã€è¿‡åº¦ç–²åŠ³æˆ–å‹åŠ›å½±å“ï¼Œåº”åŠ å¼ºä¼‘æ¯å¹¶é€‚å½“è¡¥å……èƒ½é‡`);\n        } else if(pregnancyHealth > 130) {\n            this.setvar(`bf.${female}.notifySecondary`, `${female}çš„å¦Šå¨ çŠ¶æ€åé«˜ï¼Œå¯èƒ½å‡ºç°ä»£è°¢è¿‡è½½æˆ–èƒå„¿å‘è‚²è¿‡å¿«ï¼Œå»ºè®®è°ƒæ•´ç”Ÿæ´»èŠ‚å¥å¹¶é€‚åº¦æ´»åŠ¨`);\n        }\n\n        // æ£€æŸ¥uterinePressureçŠ¶æ€\n        if(uterinePressure > 50) {\n            if(stage === 'å­•æ—©æœŸ' || stage === 'å­•ä¸­æœŸ') {\n                this.setvar(`bf.${female}.notifySecondary`, `${female}çš„å­å®«å‹åŠ›è¿‡é«˜ï¼Œæœ‰æµäº§é£é™©`);\n            } else if(stage === 'å­•æ™šæœŸ' || stage === 'ä¸´äº§æœŸ' || stage === 'é€¾æœŸ') {\n                this.setvar(`bf.${female}.notifySecondary`, `${female}çš„å­å®«å‹åŠ›è¿‡é«˜ï¼Œå³å°†ç”Ÿäº§`);\n            }\n        }\n    }\n    // æ£€æŸ¥æ˜¯å¦æœ‰notifySecondaryï¼Œå¦‚æœæœ‰åˆ™ç§»åŠ¨åˆ°notify\n    if(notifySecondary) {\n        this.setvar(`bf.${female}.notify`, notifySecondary);\n        this.setvar(`bf.${female}.notifySecondary`, null);\n        return;\n    }\n    if(stage === 'äº§å‰é˜µç—›') {\n        this.setvar(`bf.${female}.notify`, `${female}é©¬ä¸Šå°±è¦ç”Ÿäº†`);\n    } else if(forced || days === 1) {\n        if(stage === 'å­•æ—©æœŸ')\n            this.setvar(`bf.${female}.notify`, `${female}æ€€å­•äº†`);\n        else if(menstrualStage.includes(stage) || pregnancyStage.includes(stage) || laborStage.includes(stage)) {\n            this.setvar(`bf.${female}.notify`, `${female}è¿›å…¥äº†${stage}`);\n        }\n    } else {\n        this.setvar(`bf.${female}.notify`, null);\n    }\n});\ndefine('initFemale', function(female) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    // åˆå§‹åŒ–\n    this.setvar(`bf.${female}.days`, 1, { flags: 'nx' });\n    this.setvar(`bf.${female}.pregnantDays`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.laborHours`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.stage`, _.sample(menstrualStage), { flags: 'nx' });\n    this.setvar(`bf.${female}.isHere`, false, { flags: 'nx' });\n    // åˆå§‹åŒ–ç”Ÿç†ç‹€æ…‹åƒæ•¸\n    this.setvar(`bf.${female}.sperms`, [], { flags: 'nx' });\n    this.setvar(`bf.${female}.eggs`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.libido`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.uterinePressure`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.pregnancyHealth`, 100, { flags: 'nx' });\n    this.setvar(`bf.${female}.vitalityDrain`, 1.0, { flags: 'nx' });\n    this.setvar(`bf.${female}.pregnant`, [], { flags: 'nx' });\n    this.setvar(`bf.${female}.twinCounter`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.fetuses`, 0, { flags: 'nx' });\n    // åˆå§‹åŒ–ç”Ÿç†éš±è—åƒæ•¸\n    this.setvar(`bf.${female}.menstrualFluctuationDays`, 1, { flags: 'nx' });\n    this.setvar(`bf.${female}.gestationRate`, 1.0, { flags: 'nx' });\n    this.setvar(`bf.${female}.impregnationRate`, 1.0, { flags: 'nx' });\n    this.setvar(`bf.${female}.identicalProbability`, 10, { flags: 'nx' });\n    this.setvar(`bf.${female}.semiIdenticalProbability`, 2, { flags: 'nx' });\n    this.setvar(`bf.${female}.earlyFusionProbability`, 5, { flags: 'nx' });\n    this.setvar(`bf.${female}.sharedMembraneProbability`, 25, { flags: 'nx' });\n    this.setvar(`bf.${female}.superfetationProbability`, 1, { flags: 'nx' });\n    this.setvar(`bf.${female}.polyploidyProbability`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.birthDifficulty`, 1.0, { flags: 'nx' });\n    this.setvar(`bf.${female}.breedTolerance`, 1.0, { flags: 'nx' });\n    // åˆå§‹åŒ–æƒ…æ„Ÿèˆ‡æ€§ç¶“é©—\n    this.setvar(`bf.${female}.virginity`, null, { flags: 'nx' });\n    this.setvar(`bf.${female}.mate`, null, { flags: 'nx' });\n    this.setvar(`bf.${female}.latestSexPartner`, null, { flags: 'nx' });\n    this.setvar(`bf.${female}.relationshipExperience`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.sexExperience`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.pregnantExperience`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.birthExperience`, 0, { flags: 'nx' });\n    this.setvar(`bf.${female}.miscarriageExperience`, 0, { flags: 'nx' });\n    // æ–‡å­—åŒ–æ•˜è¿°\n    this.setvar(`bf.${female}.statustext`, {}, { flags: 'nx' });\n    // åˆå§‹åŒ–å¦Šå¨ å¿ƒæƒ…æŒ‡æ¨™\n    //this.setvar(`bf.${female}.pregnancyAwareness`, 0, { flags: 'nx' });\n    //this.setvar(`bf.${female}.pregnancyAcceptance`, 0, { flags: 'nx' });\n    //this.setvar(`bf.${female}.PublicAwareness`, 0, { flags: 'nx' });\n    //this.setvar(`bf.${female}.PublicAcceptance`, 0, { flags: 'nx' });\n\n    this.setvar(`bf.${female}.notify`, null, { flags: 'nx' });\n    this.setvar(`bf.${female}.notifySecondary`, null, { flags: 'nx' });\n    console.log(`runID: ${runID}`);\n    console.log(`locals.runID: ${locals.runID}`);\n    console.log(`this.runID: ${this.runID}`);\n});\ndefine('updateExperience', function(female, options = {}) {\n    if (!female || this.variables?.bf?.[female] == null) return;\n    this.initFemale(female);\n    // åªå…è®¸è¿™äº›å­—æ®µè¢«æ›´æ–°\n    const allowed = [\n        'virginity',\n        'mate',\n        'latestSexPartner',\n        'relationshipExperience',\n        'sexExperience',\n        'pregnantExperience',\n        'birthExperience',\n        'miscarriageExperience'\n    ];\n  \n    for (const key of allowed) {\n        if (options[key] !== undefined) {\n            this.setvar(`bf.${female}.${key}`, options[key]);\n        }\n    }\n});  \ndefine('updatePhysiologyProfile', function(female, options = {}) {\n    if (!female || this.variables?.bf?.[female] == null) return;\n    this.initFemale(female);\n  \n    const allowed = [\n        'menstrualFluctuationDays',\n        'gestationRate',\n        'birthDifficulty',\n        'impregnationRate',\n        'identicalProbability',\n        'semiIdenticalProbability',\n        'earlyFusionProbability',\n        'sharedMembraneProbability',\n        'superfetationProbability',\n        'polyploidyProbability',\n        'breedTolerance'\n    ];\n  \n    for (const key of allowed) {\n        if (options[key] !== undefined) {\n            this.setvar(`bf.${female}.${key}`, options[key]);\n        }\n    }\n});\ndefine('addSperm', function(female, male, amount) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    let sperms = this.getvar(`bf.${female}.sperms`, { defaults: [] });\n    let found = false;\n    for(let i = 0; i < sperms.length; i++) {\n        if(sperms[i].male === male) {\n            sperms[i].value += amount;\n            if(sperms[i].value <= 0) {\n                sperms.splice(i, 1); // å½“ç²¾å­æ•°é‡å°äºç­‰äº0æ—¶ï¼Œä»æ•°ç»„ä¸­ç§»é™¤\n            }\n            found = true;\n            break;\n        }\n    }\n    if(!found && amount > 0) {\n        sperms.push({ male: male, value: amount });\n    }\n    this.setvar(`bf.${female}.sperms`, sperms);\n});\ndefine('impregnate', function(female, male) {\n    if (!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    const stage = this.getvar(`bf.${female}.stage`);\n    if (!menstrualStage.includes(stage) && stage!=='å·²å—ç²¾' && stage!=='å­•æ—©æœŸ'){\n        return;\n    }\n    let pregnant = this.getvar(`bf.${female}.pregnant`, { defaults: [] });\n    let fetuses = this.getvar(`bf.${female}.fetuses`, { defaults: 0 });\n    let twinCounter = this.getvar(`bf.${female}.twinCounter`, { defaults: 0 });\n    const profile = this.getvar(`bf.${female}`, {\n        defaults: {\n            identicalProbability:          0,\n            semiIdenticalProbability:      0,\n            sharedMembraneProbability:     0,\n            earlyFusionProbability:        0,\n            superfetationProbability:      0,\n            polyploidyProbability:         0,\n        }\n    });\n\n    // å­•æ—©æœŸå¼‚æœŸå—å­•æ£€æŸ¥\n    if (stage === 'å­•æ—©æœŸ') {\n        if (_.random(0, 99) >= profile.superfetationProbability) {\n            return; // æœªé€šè¿‡å¼‚æœŸå—å­•æ¦‚ç‡æ£€æŸ¥ï¼Œç›´æ¥è¿”å›\n        }\n        // é€šè¿‡æ£€æŸ¥ï¼Œåˆ›å»ºå¼‚æœŸèƒ\n        let superfetationFetus = {\n            fathers: male,\n            gender: _.random(0, 1) ? 'ç”·' : 'å¥³',\n            twinId: null,\n            zygoteType: 'ç•°æœŸèƒ',\n            impregnateDay: this.getvar(`bf.${female}.pregnantDays`, { defaults: 0 }),\n            fetalAge: 0,\n            fetalBias: _.random(0.5, 0.63),\n            position: 'å¾…å®š',\n            moodEmoji: 'ğŸ’¤',\n        };\n\n        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„ç‹¬èƒï¼ˆfetalBias > 1.1ï¼Œå¥³æ€§ï¼Œç‹¬èƒï¼‰\n        let existingFetus = pregnant.find(f => \n            f.zygoteType === 'ç¨èƒ' && \n            f.fetalBias > 1.26 && \n            f.gender === 'å¥³'\n        );\n\n        // å¦‚æœæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç‹¬èƒï¼Œ50%æ¦‚ç‡å½¢æˆåµŒå¥—èƒ\n        if (existingFetus && _.random(0, 1)) {\n            existingFetus.zygoteType = 'åµŒå¥—å¤–èƒ';\n            existingFetus.twinId = twinCounter;\n            superfetationFetus.zygoteType = 'åµŒå¥—å…§èƒ';\n            superfetationFetus.fetalBias = _.random(0.4, 0.5) // é¤Šåˆ†æ›´å°‘\n            superfetationFetus.twinId = twinCounter;\n            this.incvar(`bf.${female}.twinCounter`, 1);\n        }\n\n        pregnant.push(superfetationFetus);\n        fetuses += 1;\n        this.setvar(`bf.${female}.pregnant`, pregnant);\n        this.setvar(`bf.${female}.fetuses`, fetuses);\n        return;\n    }\n\n    // æ£€æŸ¥æ˜¯å¦ä¸ºåŒæ¯æº\n    const isDualMother = this.variables?.bf?.[male] !== undefined && this.variables.bf[male] !== null;\n    // æ£€æŸ¥æ˜¯å¦ä¸ºè‡ªäº¤\n    const isSelfFertilization = male === female;\n    // å…¶ä»–å—ç²¾é¡å‹\n    const isEarlyFusion     = _.random(0, 99) < profile.earlyFusionProbability;\n    const isIdentical       = _.random(0, 99) < profile.identicalProbability;\n    const isSemiIdentical   = _.random(0, 99) < profile.semiIdenticalProbability;\n    const isSharedMembrane  = _.random(0, 99) < profile.sharedMembraneProbability;\n\n    // å¤šå€ä½“\n    const totalSperms = this.getvar(`bf.${female}.sperms`, { defaults: [] });\n    const eggs = this.getvar(`bf.${female}.eggs`, { defaults: 0 });\n    const totalSperm = totalSperms.reduce((sum, s) => sum + s.value, 0);\n    \n    if (totalSperm > 50 && eggs > 1 && _.random(0, 99) < profile.polyploidyProbability) {\n        // åˆ›å»ºå¤šå€ä½“èƒå„¿\n        let polyploidyFetus = {\n            fathers: totalSperms.map(s => s.male).join('+'),\n            gender: _.random(0, 1) ? 'ç”·' : 'å¥³',\n            twinId: null,\n            zygoteType: 'å¤šå€é«”',\n            impregnateDay: this.getvar(`bf.${female}.pregnantDays`, { defaults: 0 }),\n            fetalAge: 0,\n            fetalBias: _.random(1.58, 2.51),\n            position: 'å¾…å®š',\n            moodEmoji: 'ğŸ’¤',\n        };\n        \n        // æ¸…ç©ºæ‰€æœ‰ç²¾å­å’Œåµå­\n        this.setvar(`bf.${female}.sperms`, []);\n        this.setvar(`bf.${female}.eggs`, 0);\n        \n        pregnant.push(polyploidyFetus);\n        fetuses += 1;\n        this.setvar(`bf.${female}.pregnant`, pregnant);\n        this.setvar(`bf.${female}.fetuses`, fetuses);\n        return;\n    }\n\n    // åŒæ¯æº\n    if (isDualMother) {\n        let dualMotherFetus = {\n            fathers: male,\n            gender: 'å¥³',\n            twinId: null,\n            zygoteType: 'é›™æ¯æº',\n            impregnateDay: this.getvar(`bf.${female}.pregnantDays`, { defaults: 0 }),\n            fetalAge: 0,\n            fetalBias: _.random(0.79, 1.0),\n            position: 'å¾…å®š',\n            moodEmoji: 'ğŸ’¤',\n        };\n        pregnant.push(dualMotherFetus);\n        fetuses += 1;\n        this.setvar(`bf.${female}.pregnant`, pregnant);\n        this.setvar(`bf.${female}.fetuses`, fetuses);\n        return;\n    }\n\n    // è‡ªäº¤åµ\n    if (isSelfFertilization) {\n        let selfFertilizationFetus = {\n            fathers: male,\n            gender: 'æ‰¶å¥¹',\n            twinId: null,\n            zygoteType: 'è‡ªäº¤åµ',\n            impregnateDay: this.getvar(`bf.${female}.pregnantDays`, { defaults: 0 }),\n            fetalAge: 0,\n            fetalBias: _.random(1.26, 1.58),\n            position: 'å¾…å®š',\n            moodEmoji: 'ğŸ’¤',\n        };\n        pregnant.push(selfFertilizationFetus);\n        fetuses += 1;\n        this.setvar(`bf.${female}.pregnant`, pregnant);\n        this.setvar(`bf.${female}.fetuses`, fetuses);\n        return;\n    }\n    // æ—©æœŸèåˆ, å¦‚æœæ‰¾åˆ°ç‹¬èƒï¼Œåˆ™åˆå¹¶çˆ¶äº²ä¿¡æ¯å¹¶è®¾ä¸ºèåˆåµ\n    if (isEarlyFusion) {\n        let existingFetus = pregnant.find(f => f.zygoteType === 'ç¨èƒ');\n        if (existingFetus) {\n            if (existingFetus.fathers !== male) {\n                existingFetus.fathers = `${existingFetus.fathers}+${male}`;\n            }\n            existingFetus.zygoteType = 'èåˆåµ';\n            existingFetus.twinId = twinCounter;\n            this.incvar(`bf.${female}.twinCounter`, 1);\n            existingFetus.fetalBias = _.random(1.58, 2.0);\n            // 50%æ¦‚ç‡å˜æˆæ‰¶å¥¹\n            if (_.random(0, 1)) {\n                existingFetus.gender = 'æ‰¶å¥¹';\n            }\n            this.setvar(`bf.${female}.pregnant`, pregnant);\n            this.setvar(`bf.${female}.fetuses`, fetuses); //èƒå…’æ•¸ä¸æœƒè®Šå‹•\n            return;\n        }\n    }\n    // å‡†å¤‡æ–°èƒå„¿çš„åŸºç¡€å±æ€§\n    let newFetus = {\n        fathers: male,\n        gender: _.random(0, 1) ? 'ç”·' : 'å¥³',\n        twinId: null,\n        zygoteType: 'ç¨èƒ',\n        impregnateDay: this.getvar(`bf.${female}.pregnantDays`, { defaults: 0 }),\n        fetalAge: 0,\n        fetalBias: _.random(1.0, 1.26),\n        position: 'å¾…å®š',\n        moodEmoji: 'ğŸ’¤',\n    };\n    // åŒèƒèƒæ¦‚ç‡è®¡ç®—\n    const sperms = this.getvar(`bf.${female}.sperms`, { defaults: [] });\n\n    if (isIdentical) {\n        let twinFetus;\n        const twinId = twinCounter;\n\n        if (isSemiIdentical) {\n            // åŠåŒåµåŒèƒèƒï¼šçˆ¶äº²ä¸å†è¦æ±‚ä¸åŒï¼Œä¸åŒåˆ™åˆå¹¶ï¼›ç”Ÿé•¿åç½®å¤§å°åŒºåˆ†\n            const allFathers = sperms.map(s => s.male);\n            const secondFather = _.sample(allFathers);\n            const fatherStr = (secondFather !== male) ? `${male}+${secondFather}` : male;\n            newFetus.fathers = fatherStr;\n            newFetus.zygoteType = 'åŠåŒåµ';\n            newFetus.fetalBias = _.random(1.26, 1.58);\n\n            twinFetus = {\n                fathers: fatherStr,\n                gender: _.random(0, 1) ? 'ç”·' : 'å¥³',\n                twinId,\n                zygoteType: 'åŠåŒåµ',\n                impregnateDay: newFetus.impregnateDay,\n                fetalAge: 0,\n                fetalBias: _.random(0.79, 1.0),\n                position: 'å¾…å®š',\n                moodEmoji: 'ğŸ’¤',\n            };\n        } else {\n            // çº¯åŒåµåŒèƒèƒï¼šæ ¹æ®æ˜¯å¦å…±äº«è†œï¼Œ50% è½¬ä¸ºé•œåƒåŒèƒèƒ\n            let bias1, bias2;\n            let type1, type2;\n            if (isSharedMembrane) {\n                const isMirror = _.random(0, 99) < 50;\n                if (isMirror) {\n                    const mirrorBias = _.random(0.5, 1.0);\n                    bias1 = mirrorBias;\n                    bias2 = mirrorBias;\n                    type1 = type2 = 'é¡åƒ';\n                } else {\n                    bias1 = _.random(0.79, 1.0);\n                    bias2 = _.random(0.79, 1.0);\n                    type1 = type2 = 'å…±å›Š';\n                }\n            } else {\n                bias1 = _.random(0.5, 1.0);\n                bias2 = _.random(0.5, 1.0);\n                type1 = type2 = 'åˆ†å›Š';\n            }\n\n            newFetus.zygoteType = type1;\n            newFetus.fetalBias = bias1;\n            twinFetus = {\n                fathers: male,\n                gender: newFetus.gender,\n                twinId,\n                zygoteType: type2,\n                impregnateDay: newFetus.impregnateDay,\n                fetalAge: 0,\n                fetalBias: bias2,\n                position: 'å¾…å®š',\n                moodEmoji: 'ğŸ’¤',\n            };\n        }\n\n        newFetus.twinId = twinId;\n        this.incvar(`bf.${female}.twinCounter`, 1);\n        pregnant.push(newFetus, twinFetus);\n        fetuses += 2;\n    } else {\n        // å•èƒ\n        pregnant.push(newFetus);\n        fetuses += 1;\n    }\n\n    this.setvar(`bf.${female}.pregnant`, pregnant);\n    this.setvar(`bf.${female}.fetuses`, fetuses);\n});\ndefine('setMenstrualPhases', function(female, stage) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    let cur = this.getvar(`bf.${female}.stage`);\n    if(menstrualStage.includes(cur) && menstrualStage.includes(stage)) {\n        this.setvar(`bf.${female}`, { stage, days: 1 }, { merge: true });\n        this.notifyCycle(female);\n    }\n});\ndefine('addEggs', function(female, amount = 1) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    this.incvar(`bf.${female}.eggs`, amount);\n    this.incvar(`bf.${female}.uterinePressure`, 2); //æ’åµç—›\n});\ndefine('setPregnantDirectly', function(female, male, n = 1, pregnantDays = 1, force = false) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    \n    // å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿è§’è‰²å¤„äºæœˆç»å‘¨æœŸé˜¶æ®µï¼Œé™¤éforceä¸ºtrue\n    const currentStage = this.getvar(`bf.${female}.stage`);\n    if(!force && !menstrualStage.includes(currentStage)) {\n        console.log(`Cannot set pregnancy for ${female}: not in menstrual stage`);\n        return;\n    }\n    \n    // æ¸…ç©ºå½“å‰çŠ¶æ€\n    this.setvar(`bf.${female}.stage`, 'æ’åµæœŸ');\n    this.setvar(`bf.${female}.pregnant`, []);\n    this.setvar(`bf.${female}.fetuses`, 0);\n    this.setvar(`bf.${female}.twinCounter`, 0);\n    this.setvar(`bf.${female}.pregnantDays`, 0);\n    this.setvar(`bf.${female}.laborHours`, 0);\n    \n    // æ‰§è¡Œnæ¬¡impregnate\n    for(let i = 0; i < n; i++) {\n        this.impregnate(female, male);\n    }\n    \n    // è®¾ç½®å­•æœŸå¤©æ•°\n    this.setvar(`bf.${female}.pregnantDays`, pregnantDays);\n    let gestationRate = this.getvar(`bf.${female}.gestationRate`, { defaults: 1.0 });\n    \n    // ç¡®å®šå½“å‰å­•æœŸé˜¶æ®µå’Œå½“å‰é˜¶æ®µçš„å¤©æ•°\n    let stage = 'å­•æ—©æœŸ';\n    let baseDays = 1;\n    let currentStageDays = 1;\n    for(let i = 0; i < pregnancyStage.length; i++) {\n        let nextBaseDays = baseDays + pregnancyStageDays[pregnancyStage[i]] / gestationRate;\n        if(pregnantDays >= baseDays && pregnantDays < nextBaseDays) {\n            stage = pregnancyStage[i];\n            currentStageDays = Math.floor(pregnantDays - baseDays + 1);\n            break;\n        }\n        baseDays = nextBaseDays;\n    }\n    \n    // æ›´æ–°é˜¶æ®µå’Œå½“å‰é˜¶æ®µå¤©æ•°\n    this.setvar(`bf.${female}.stage`, stage);\n    this.setvar(`bf.${female}.days`, currentStageDays);\n    \n    // æ›´æ–°æ‰€æœ‰èƒå„¿çš„å®é™…å‘è‚²æƒ…å†µèˆ‡èƒ½é‡æ¶ˆè€—\n    let pregnant = this.getvar(`bf.${female}.pregnant`, { defaults: [] });\n    let breedTolerance = this.getvar(`bf.${female}.breedTolerance`, { defaults: 1.0 });\n    let fetalAgeSum = 0;\n    for(let fetus of pregnant) {\n        // è®¡ç®—èƒå„¿å®é™…å‘è‚²å‘¨æ•°\n        let AgeInDays = (pregnantDays - fetus.impregnateDay) * gestationRate * fetus.fetalBias;\n        fetus.fetalAge = AgeInDays / 7;\n        fetalAgeSum += fetus.fetalAge;\n    }\n    let vitalityDrain = (fetalAgeSum / 40) / breedTolerance; \n    \n    this.setvar(`bf.${female}.pregnant`, pregnant);\n    this.setvar(`bf.${female}.vitalityDrain`, vitalityDrain);\n    this.notifyCycle(female);\n});\ndefine('endPregnancy', function(female, miscarriage = false) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    let fetuses = this.getvar(`bf.${female}.fetuses`);\n    if(fetuses) {\n        if(miscarriage) {\n            this.incvar(`bf.${female}.miscarriageExperience`, 1);\n            this.setvar(`bf.${female}.notifySecondary`, `${female}æµç”¢äº†`);\n        } else {\n            this.incvar(`bf.${female}.birthExperience`, 1);\n            this.setvar(`bf.${female}.notifySecondary`, `${female}ç”Ÿä¸‹äº†${fetuses}ä¸ªå­©å­`);\n        }\n        this.setvar(`bf.${female}`, { \n            stage: 'äº§åæ¢å¤', \n            days: 1,\n            pregnant: [],\n            fetuses: 0,\n            twinCounter: 0,\n            uterinePressure: 0,\n            laborHours: 0\n        }, { merge: true });\n    }\n});\ndefine('adjustFetalBias', function(female, fetusIndex, newBias) {\n    if (!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    let pregnant = this.getvar(`bf.${female}.pregnant`, { defaults: [] });\n    if (fetusIndex < 0 || fetusIndex >= pregnant.length) return;\n\n    let currentFetus = pregnant[fetusIndex];\n    const twinId = currentFetus.twinId;\n\n    // é•œåƒåŒèƒèƒï¼šå¦ä¸€èƒåç½®ä»…ä¸å½“å‰èƒå·®å¼‚Â±0.01\n    if (currentFetus.zygoteType === 'é¡åƒ' && twinId != null) {\n        // è®¾ç½®å½“å‰èƒåç½®\n        currentFetus.fetalBias = newBias;\n        // æ‰¾åˆ°é•œåƒåŒèƒèƒ\n        let mirrorTwin = pregnant.find(f => f !== currentFetus && f.twinId === twinId && f.zygoteType === 'é¡åƒ');\n        if (mirrorTwin) {\n            // éšæœºåœ¨[-0.01, 0.01]èŒƒå›´å†…å¾®è°ƒ\n            let delta = (Math.random() * 0.02) - 0.01;\n            mirrorTwin.fetalBias = Math.max(0.5, Math.min(2.0, newBias + delta));\n        }\n        this.setvar(`bf.${female}.pregnant`, pregnant);\n        return;\n    }\n    // åŠåŒåµåŒèƒèƒï¼š50% æ¦‚ç‡æŠŠ newBias å–‚ç»™\"å¦ä¸€èƒ\"\n    if (currentFetus.zygoteType === 'åŠåŒåµ' && twinId != null) {\n        let sibling = pregnant.find(f => f !== currentFetus && f.twinId === twinId && f.zygoteType === 'åŠåŒåµ');\n        if (sibling && Math.random() < 0.5) {\n            // ä¸€åŠæœºç‡ä½œç”¨åˆ°å¦ä¸€èƒ\n            sibling.fetalBias = newBias;\n        } else {\n            // å¦ä¸€åŠæœºç‡ä½œç”¨åˆ°å½“å‰\n            currentFetus.fetalBias = newBias;\n        }\n        this.setvar(`bf.${female}.pregnant`, pregnant);\n        return;\n  }\n\n    // éé•œåƒæˆ–å…¶ä»–æƒ…å†µ\n    currentFetus.fetalBias = newBias;\n    this.setvar(`bf.${female}.pregnant`, pregnant);\n});\n\ndefine('adjustFetalPosition', function(female, fetusIndex, newPosition) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    let pregnant = this.getvar(`bf.${female}.pregnant`, { defaults: [] });\n    if(fetusIndex < 0 || fetusIndex >= pregnant.length) return;\n\n    // æ£€æŸ¥æ–°ä½ç½®æ˜¯å¦æœ‰æ•ˆ\n    if(!fetusPosition.includes(newPosition)) return;\n\n    let currentFetus = pregnant[fetusIndex];\n    const twinId = currentFetus.twinId;\n\n    // é¡åƒé›™èƒèƒï¼šä»»æ„ä½ç½®è¨­å®šéƒ½åŒæ­¥åˆ°å¦ä¸€èƒèƒï¼ŒåŒ…æ‹¬ç³¾çº\n    if(currentFetus.zygoteType === 'é¡åƒ' && twinId != null) {\n        let mirrorTwin = pregnant.find(f => f !== currentFetus && f.twinId === twinId && f.zygoteType === 'é¡åƒ');\n        if(mirrorTwin) {\n            currentFetus.position = newPosition;\n            mirrorTwin.position = newPosition;\n            this.setvar(`bf.${female}.pregnant`, pregnant);\n            return;\n        }\n    }\n\n    // å…±å›Šé›™èƒèƒç³¾çºç‹€æ…‹\n    if(newPosition === 'ç³¾çº') {\n        if(currentFetus.zygoteType !== 'å…±å›Š') return;\n        let twinFetus = pregnant.find(f => \n            f !== currentFetus && f.twinId === twinId && f.zygoteType === 'å…±å›Š'\n        );\n        if(!twinFetus) return;\n        currentFetus.position = 'ç³¾çº';\n        twinFetus.position = 'ç³¾çº';\n    } else {\n        // å…¶ä»–ä½ç½®ç›´æ¥è¨­å®š\n        currentFetus.position = newPosition;\n    }\n\n    this.setvar(`bf.${female}.pregnant`, pregnant);\n});\ndefine('adjustMoodEmoji', function(female, fetusIndex, newMoodEmoji) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    let pregnant = this.getvar(`bf.${female}.pregnant`, { defaults: [] });\n    if(fetusIndex >= 0 && fetusIndex < pregnant.length) {\n        pregnant[fetusIndex].moodEmoji = newMoodEmoji;\n        this.setvar(`bf.${female}.pregnant`, pregnant);\n    }\n});\ndefine('passedTime', function(opt = { minute: 15 }) {\n    let remaining = (opt.day || 0) +\n        ((opt.hour || 0) * (1 / 24)) +\n        ((opt.minute || 0) * (1 / 24 / 60)) +\n        ((opt.second || 0) * (1 / 24 / 60 / 60)) +\n        (opt.month || 0) * 30 +\n        (opt.week || 0) * 7 +\n        (opt.year || 0) * 365;\n    while(remaining > 0) {\n        const passed = remaining > 1 ? 1 : remaining;\n        remaining -= passed;\n        for(let [char, data] of _.entries(this.variables.bf)) {\n            if(!char || !data) continue;\n            let stage = data.stage || 'åµæ³¡æœŸ';\n            // å–å‡ºèˆŠçš„å¤©æ•¸\n            const oldDays = data.days || 0;\n            const newDays = oldDays + passed;\n\n            // ç”±å¤©æ•¸æ¨ç®—ï¼šæ™‚ã€å¤©ã€é€±ã€æœˆ\n            const oldHourCount  = Math.floor(oldDays  * 24);\n            const newHourCount  = Math.floor(newDays  * 24);\n\n            const oldDayCount   = Math.floor(oldDays);\n            const newDayCount   = Math.floor(newDays);\n\n            const oldWeekCount  = Math.floor(oldDays  / 7);\n            const newWeekCount  = Math.floor(newDays  / 7);\n\n            const oldMonthCount = Math.floor(oldDays  / 30);\n            const newMonthCount = Math.floor(newDays  / 30);\n\n            // åˆ¤æ–·æ˜¯å¦ã€Œæ–°ã€ä¸€å°æ™‚ã€ä¸€æ—¥ã€ä¸€é€±ã€ä¸€æœˆ\n            const isNewHour  = newHourCount  > oldHourCount;\n            const isNewDay   = newDayCount   > oldDayCount;\n            const isNewWeek  = newWeekCount  > oldWeekCount;\n            const isNewMonth = newMonthCount > oldMonthCount;\n\n             // å¯«å›æœ€æ–°å¤©æ•¸\n            this.setvar(`bf.${char}.days`, newDays);\n            \n            // å¦‚æœæ˜¯æ€€å­•çŠ¶æ€ï¼Œç´¯åŠ æ€€å­•å¤©æ•°\n            if(pregnancyStage.includes(stage) || stage === 'äº§å‰é˜µç—›' || laborStage.includes(stage)) {\n                let pregnantDays = this.getvar(`bf.${char}.pregnantDays`, { defaults: 0 });\n                pregnantDays += passed;\n                this.setvar(`bf.${char}.pregnantDays`, pregnantDays);\n                \n                // æ›´æ–°æ¯ä¸ªèƒå„¿çš„å®é™…å‘è‚²æƒ…å†µ\n                let pregnant = this.getvar(`bf.${char}.pregnant`, { defaults: [] });\n                let gestationRate = this.getvar(`bf.${char}.gestationRate`, { defaults: 1.0 });\n                \n                for(let fetus of pregnant) {\n                    // è®¡ç®—èƒå„¿å®é™…å‘è‚²å‘¨æ•°\n                    let AgeInDays = (pregnantDays - fetus.impregnateDay) * gestationRate * fetus.fetalBias;\n                    fetus.fetalAge = AgeInDays / 7;\n                }\n                \n                this.setvar(`bf.${char}.pregnant`, pregnant);\n            }\n\n            if(menstrualStage.includes(stage)) {\n                // è®¡ç®—å½“å‰é˜¶æ®µçš„å®é™…å¤©æ•°ï¼ˆåŒ…æ‹¬æ³¢åŠ¨ï¼‰\n                let menstrualFluctuationDays = this.getvar(`bf.${char}.menstrualFluctuationDays`, { defaults: 1 });\n                let actualDays = menstrualStageDays[stage] + _.random(0, menstrualFluctuationDays);\n                if(newDayCount > actualDays) {\n                    let nextIndex = (menstrualStage.indexOf(stage) + 1) % menstrualStage.length;\n                    stage = menstrualStage[nextIndex];\n                    // è®¡ç®—\"è·¨é˜¶æ®µå‰©ä½™å¤©æ•°\"\n                    const overflowDays = newDayCount - actualDays;\n                    const nextStageDays = Math.max(1, overflowDays);\n                    this.setvar(`bf.${char}`, { stage, days: nextStageDays }, { merge: true });\n                }\n                if (stage === 'æœˆç»æœŸ' && isNewDay){\n                    this.incvar(`bf.${char}.uterinePressure`, 5); //æœˆç¶“ç—›\n                }\n            } else if(pregnancyStage.includes(stage)) {\n                let pregnantDays = this.getvar(`bf.${char}.pregnantDays`, { defaults: 0 });\n                const gestationRate = this.getvar(`bf.${char}.gestationRate`, { defaults: 1.0 });\n                const isHere =  this.getvar(`bf.${char}.isHere`, { defaults: false });\n                // è¨ˆç®—vitalityDrain\n                let pregnant = this.getvar(`bf.${char}.pregnant`, { defaults: [] });\n                let breedTolerance = this.getvar(`bf.${char}.breedTolerance`, { defaults: 1.0 });\n                let fetalAgeSum = 0;\n                for(let fetus of pregnant) {\n                    fetalAgeSum += fetus.fetalAge;\n                }\n                let fetalLoad = fetalAgeSum / 40; // éš¨è‘—å­•æœŸç™¼å±•, è€—èƒ½é€æ¼¸å¢åŠ \n                let vitalityDrain = fetalLoad / breedTolerance; \n                this.setvar(`bf.${char}.vitalityDrain`, vitalityDrain);\n\n                //è·¨æ—¥\n                let uterinePressure = this.getvar(`bf.${char}.uterinePressure`, { defaults: 0 });\n                let pregnancyHealth = this.getvar(`bf.${char}.pregnancyHealth`, { defaults: 100 });\n                if(stage === 'é€¾æœŸ') {\n                    if(isNewDay) {\n                        const overdueDays = pregnantDays/gestationRate - 280; //é‚„åŸäººé¡é€¾æœŸå¤©æ•¸\n                        // è‡ªç„¶å‚¬ç”¢\n                        this.incvar(`bf.${char}.uterinePressure`, vitalityDrain*(newDayCount-oldDayCount) + overdueDays*0.5);\n                        const overdueMultiplier = 1 + overdueDays * 0.02; // æ¯å¤©+2%ï¼Œé€æ—¥ç´¯åŠ æƒ¡åŒ–\n                        this.incvar(`bf.${char}.pregnancyHealth`, -vitalityDrain * overdueMultiplier);\n                    }\n                } else {\n                    // è®¡ç®—å½“å‰é˜¶æ®µçš„å¤©æ•°é˜ˆå€¼\n                    let currentStageIndex = pregnancyStage.indexOf(stage);\n                    let baseDays = 0;\n                    // è®¡ç®—å½“å‰é˜¶æ®µä¹‹å‰çš„æ‰€æœ‰é˜¶æ®µå¤©æ•°æ€»å’Œ\n                    for(let i = 0; i < currentStageIndex; i++) {\n                        baseDays += pregnancyStageDays[pregnancyStage[i]] / gestationRate;\n                    }\n                    // è®¡ç®—å½“å‰é˜¶æ®µçš„å¤©æ•°é˜ˆå€¼\n                    let daysThreshold = baseDays + pregnancyStageDays[stage] / gestationRate;\n                    \n                    // å¦‚æœè¶…è¿‡å½“å‰é˜¶æ®µé˜ˆå€¼ï¼Œéœ€è¦ç¡®å®šæœ€ç»ˆé˜¶æ®µ\n                    if(pregnantDays >= daysThreshold) {\n                        let finalStage = stage;\n                        let finalStageDays = 1;\n                        let remainingDays = pregnantDays;\n                        \n                        // éå†æ‰€æœ‰åç»­é˜¶æ®µï¼Œæ‰¾åˆ°æœ€ç»ˆé˜¶æ®µ\n                        for(let i = currentStageIndex; i < pregnancyStage.length; i++) {\n                            let stageDays = pregnancyStageDays[pregnancyStage[i]] / gestationRate;\n                            if(remainingDays >= stageDays) {\n                                remainingDays -= stageDays;\n                                if(i < pregnancyStage.length - 1) {\n                                    finalStage = pregnancyStage[i + 1];\n                                } else {\n                                    finalStage = 'é€¾æœŸ';\n                                }\n                            } else {\n                                finalStageDays = Math.max(1, Math.floor(remainingDays));\n                                break;\n                            }\n                        }\n                        \n                        this.setvar(`bf.${char}`, { stage: finalStage, days: finalStageDays }, { merge: true });\n                        this.notifyCycle(char, true);\n                    }\n                    \n                    if(isNewDay && isHere) {\n                        // æ—¥å¸¸å­•æœŸå£“åŠ›ï¼Œè§’è‰²éœ€åœ¨å ´æ‰åŸ·è¡Œäº‹ä»¶åˆ¤å®š\n                        this.incvar(`bf.${char}.uterinePressure`, vitalityDrain*(newDayCount-oldDayCount)); \n                        this.incvar(`bf.${char}.pregnancyHealth`, -vitalityDrain*(newDayCount-oldDayCount)); \n                    }\n                }\n\n                //åˆ†å¨©åˆ¤å®šï¼Œè§’è‰²éœ€åœ¨å ´æ‰åŸ·è¡Œäº‹ä»¶åˆ¤å®š\n                if(uterinePressure >= 80 && isHere) {\n                    if(stage === 'å­•æ—©æœŸ' || stage === 'å­•ä¸­æœŸ') {\n                        // æ—©æœŸå’Œä¸­æœŸå‹åŠ›è¿‡å¤§å¯¼è‡´æµäº§\n                        this.endPregnancy(char, true);\n                    } else if(stage === 'å­•æ™šæœŸ' || stage === 'ä¸´äº§æœŸ' || stage === 'é€¾æœŸ') {\n                        // æ™šæœŸã€ä¸´äº§æœŸå’Œé€¾æœŸå¯ä»¥è§¦å‘äº§å‰é˜µç—›\n                        this.setvar(`bf.${char}`, { stage: 'äº§å‰é˜µç—›', days: 1 }, { merge: true });\n                        this.notifyCycle(char, true);\n                    }\n                }\n                //è·¨é€±\n                if (isNewWeek){\n                    let biasAdjustment = (pregnancyHealth-100) / 2000 * (newWeekCount - oldWeekCount);\n                    for (let i=0; i<pregnant.length; i++){\n                        const oldBias = pregnant[i].fetalBias;\n                        this.adjustFetalBias(char, i, biasAdjustment + oldBias);\n                    }\n                }\n                //è·¨æœˆ\n                if (isNewMonth){\n                    let fetalBiasSum = 0;\n                    for(let fetus of pregnant) {\n                        fetalBiasSum += fetus.fetalBias;\n                    }\n                    let fetalBiasAvg = pregnant.length > 0 ? fetalBiasSum / pregnant.length : 0;\n                    let adjustBreedTolerance = (1 - fetalBiasAvg) * 0.01*(newMonthCount - oldMonthCount);  // èƒå…’åå°ï¼Œé©æ‡‰åŠ›æå‡\n                    let adjustBirthDifficulty = (fetalBiasAvg - 1)**2 * 0.02*(newMonthCount - oldMonthCount); // èƒå…’åå¤§ï¼Œé›£ç”¢ç‡ä¸Šå‡\n                    this.incvar(`bf.${char}.breedTolerance`, adjustBreedTolerance);\n                    this.incvar(`bf.${char}.birthDifficulty`, adjustBirthDifficulty);\n                }\n\n                \n            } else if (stage === 'äº§å‰é˜µç—›') {\n                if(_.random(1, 3) === 1) {\n                    this.setvar(`bf.${char}`, { stage: 'ç¬¬ä¸€äº§ç¨‹', days: 1 }, { merge: true });\n                }\n            } else if (laborStage.includes(stage)) {\n                this.inLabor(char, passed);\n            } else if (stage === 'äº§åæ¢å¤') {\n                let birthDifficulty = this.getvar(`bf.${char}.birthDifficulty`, { defaults: 1.0 });\n                let gestationRate = this.getvar(`bf.${char}.gestationRate`, { defaults: 1.0 });\n                let recoveryDays = 28 * birthDifficulty / gestationRate;\n                if(newDayCount > recoveryDays) {\n                    this.setvar(`bf.${char}`, { stage: _.sample(menstrualStage), days: 1, pregnant: [] }, { merge: true });\n                }\n            } else if (stage == 'å·²å—ç²¾') {\n                if(newDayCount > 2 && _.random(0, 1)) {\n                    this.incvar(`bf.${char}.pregnantExperience`, 1);\n                    this.setvar(`bf.${char}`, { stage: 'å­•æ—©æœŸ', days: 1 }, { merge: true });\n                }\n            }\n\n            if(stage === 'æ’åµæœŸ' && isNewDay) {\n                // æ’åµæœŸæ¯å¤©éƒ½æœ‰æœºä¼šæ’åµ\n                this.addEggs(char, 1);\n            }\n\n            let eggs = data.eggs || 0;\n            if(eggs > 0) {\n                // åµå­åªåœ¨éæ’åµæœŸå‡å°‘\n                if(isNewDay && stage !== 'æ’åµæœŸ') {\n                    eggs -= 1;\n                }\n                if(stage === 'æœˆç»æœŸ') {\n                    eggs = 0;\n                }\n            }\n            for(let egg = 1; egg < eggs; egg++) {\n                let impregnationRate = this.getvar(`bf.${char}.impregnationRate`, { defaults: 1.0 });\n                let baseChance = 10 * impregnationRate; // åŸºç¡€å—å­•æ¦‚ç‡é˜ˆå€¼\n                let chance = _.random(1, 1000) * passed;\n                console.log(`impregnate chance ${chance} for ${char} (probability: ${impregnationRate})`);\n                if(chance > baseChance) {\n                    let sperms = this.getvar(`bf.${char}.sperms`, { defaults: [] });\n                    let availableSperms = sperms.filter(s => s.value > 0);\n                    if(availableSperms.length > 0) {\n                        let selectedSperm = _.sample(availableSperms);\n                        this.addSperm(char, selectedSperm.male, -10 * passed);\n                        this.impregnate(char, selectedSperm.male);\n                        eggs -= 1;\n                    }\n                }\n            }\n\n            if(menstrualStage.includes(stage) && data.fetuses > 0) {\n                this.setvar(`bf.${char}`, { stage: 'å·²å—ç²¾', days: 1 }, { merge: true });\n            }\n            \n            // æ£€æŸ¥é«˜æ½®æ’åµ\n            let libido = this.getvar(`bf.${char}.libido`, { defaults: 0 });\n            if (libido >= 100) {\n                // åªåœ¨æœˆç»å‘¨æœŸã€å·²å—ç²¾å’Œå­•æ—©æœŸå…è®¸æ’åµ\n                if (menstrualStage.includes(stage) || stage === 'å·²å—ç²¾' || stage === 'å­•æ—©æœŸ') {\n                    // ç›´æ¥æ’åµ\n                    //this.addEggs(char, 1);\n                    // è®¾ç½®æç¤ºä¿¡æ¯\n                    this.setvar(`bf.${char}.notifySecondary`, `${char}å› é«˜æ½®è€Œé¡å¤–æ’åµï¼Œæ€§æ…¾æ­¸é›¶`);\n                } else {\n                    // å…¶ä»–å‘¨æœŸåªé‡ç½®æ€§æ¬²\n                    this.setvar(`bf.${char}.notifySecondary`, `${char}å› é«˜æ½®è€Œæ€§æ…¾æ­¸é›¶`);\n                }\n                // é‡ç½®æ€§æ¬²å€¼ï¼Œè¿›å…¥å†·å´\n                //this.setvar(`bf.${char}.libido`, 0);\n            }\n            \n            let sperms = this.getvar(`bf.${char}.sperms`, { defaults: [] });\n            for(let sperm of sperms) {\n                if(sperm.value > 0) {\n                    if(stage === 'æœˆç»æœŸ') {\n                        sperm.value = 0;\n                    } else {\n                        this.addSperm(char, sperm.male, -passed * 10);\n                    }\n                }\n            }\n            // æœˆç¶“é€±æœŸ, å·²å—ç²¾, å­•æ—©æœŸ, å’Œäº§åæ¢å¤éƒ½å…è¨±ç²¾å­ç•™å­˜\n            if(!menstrualStage.includes(stage) && stage !== 'å·²å—ç²¾' && stage !== 'å­•æ—©æœŸ' && stage !== 'äº§åæ¢å¤') {\n                this.setvar(`bf.${char}.sperms`, []);\n            }\n            \n            this.setvar(`bf.${char}.eggs`, eggs);\n            this.notifyCycle(char);\n        }\n    }\n});\ndefine('inLabor', function(female, passed) {\n    if(!female || this.variables?.bf?.[female] === null) return;\n    this.initFemale(female);\n    let stage = this.getvar(`bf.${female}.stage`);\n    let pregnant = this.getvar(`bf.${female}.pregnant`, { defaults: [] });\n    let fetuses = this.getvar(`bf.${female}.fetuses`, { defaults: 1 });\n    let birthDifficulty = this.getvar(`bf.${female}.birthDifficulty`, { defaults: 1.0 });\n    let uterinePressure = this.getvar(`bf.${female}.uterinePressure`, { defaults: 0 });\n    let passedHours = passed * 24; // å°†å¤©æ•°è½¬æ¢ä¸ºå°æ—¶\n    \n    // è®¡ç®—å„äº§ç¨‹æ‰€éœ€æ—¶é—´\n    let t1 = (laborStageBaseHours['ç¬¬ä¸€äº§ç¨‹'] + (fetuses - 1) * laborStageIncrement['ç¬¬ä¸€äº§ç¨‹']) * birthDifficulty;\n    let t2 = (laborStageBaseHours['ç¬¬äºŒäº§ç¨‹'] + (fetuses - 1) * laborStageIncrement['ç¬¬äºŒäº§ç¨‹']) * birthDifficulty;\n    let t3 = (laborStageBaseHours['ç¬¬ä¸‰äº§ç¨‹'] + (fetuses - 1) * laborStageIncrement['ç¬¬ä¸‰äº§ç¨‹']) * birthDifficulty;\n    \n    // è·å–å½“å‰äº§ç¨‹å·²è¿›è¡Œçš„æ—¶é—´\n    let currentStageHours = this.getvar(`bf.${female}.laborHours`, { defaults: 0 });\n\n    if(uterinePressure < 80){\n        let chanceToStall = 100 - uterinePressure;\n        if (_.random(0, 99) < chanceToStall) {\n            // ç”¢ç¨‹åœæ»¯ï¼Œä¸æ¨é€²æ™‚é–“\n            this.setvar(`bf.${female}.notifySecondary`, `${female}çš„å­å®«æ”¶ç¼©å¾®å¼±ï¼Œäº§ç¨‹è¿›å±•åœæ»`);\n            return; \n        }\n    } else if(uterinePressure >= 120) {\n        // å½“å­å®«å‹åŠ›è¾¾åˆ°120æ—¶ï¼Œäº§ç¨‹åŠ é€Ÿ\n        if(stage === 'ç¬¬ä¸€äº§ç¨‹') {\n            // ç›´æ¥è¿›å…¥ç¬¬äºŒäº§ç¨‹\n            this.setvar(`bf.${female}`, {stage: 'ç¬¬äºŒäº§ç¨‹'}, { merge: true });\n            this.setvar(`bf.${female}.notifySecondary`, `${female}çš„å­å®«å‹åŠ›è¿‡å¤§ï¼Œäº§ç¨‹åŠ é€Ÿï¼`);\n            this.notifyCycle(female, true);\n        } else if(stage === 'ç¬¬äºŒäº§ç¨‹') {\n            // ç¬¬äºŒäº§ç¨‹åŠ é€Ÿï¼Œè®©ä¸€ä¸ªèƒå„¿å‡ºç”Ÿ\n            if(pregnant.length > 0) {\n                let msg = this.getvar(`bf.${female}.notifySecondary`, { defaults: '' });\n                let baby = pregnant.shift();\n                msg += `${female} ç”Ÿä¸‹äº† ${baby.fathers} çš„å­©å­ï¼Œæ€§åˆ¥ç‚º ${baby.gender}\\n`;\n                this.setvar(`bf.${female}.pregnant`, pregnant);\n                this.setvar(`bf.${female}.notifySecondary`, msg);\n                \n                // å¦‚æœæ‰€æœ‰èƒå„¿éƒ½å·²å‡ºç”Ÿï¼Œè¿›å…¥ç¬¬ä¸‰äº§ç¨‹\n                if(pregnant.length === 0) {\n                    this.setvar(`bf.${female}`, {stage: 'ç¬¬ä¸‰äº§ç¨‹'}, { merge: true });\n                    this.notifyCycle(female, true);\n                }\n            }\n        } else if(stage === 'ç¬¬ä¸‰äº§ç¨‹') {\n            // ç¬¬ä¸‰äº§ç¨‹ç›´æ¥ç»“æŸåˆ†å¨©\n            this.endPregnancy(female);\n        }\n        return;\n    }\n\n    currentStageHours += passedHours;\n    this.setvar(`bf.${female}.laborHours`, currentStageHours);\n    // æ ¹æ®å½“å‰äº§ç¨‹åˆ¤æ–­æ˜¯å¦è¿›å…¥ä¸‹ä¸€é˜¶æ®µ\n    if(stage === 'ç¬¬ä¸€äº§ç¨‹'){\n        if(currentStageHours>=t1){\n            // è¿›å…¥ç¬¬äºŒäº§ç¨‹\n            this.setvar(`bf.${female}`, {stage: 'ç¬¬äºŒäº§ç¨‹'}, { merge: true });\n            this.notifyCycle(female, true);\n        }\n    } else if(stage === 'ç¬¬äºŒäº§ç¨‹') {\n        // è®¡ç®—è‡ªç¬¬ä¸€äº§ç¨‹ç»“æŸåï¼Œåœ¨ç¬¬äºŒäº§ç¨‹é‡Œåˆ°åº•è¿‡äº†å¤šå°‘å°æ—¶\n        let hoursInSecond = currentStageHours - t1;\n        // ä¸€ä¸ªèƒå„¿å‡ºç”Ÿéœ€è¦çš„å°æ—¶æ•°\n        let inc2 = laborStageIncrement['ç¬¬äºŒäº§ç¨‹'] * birthDifficulty;        \n        // èƒ½å‡ºç”Ÿå¤šå°‘ä¸ªï¼ˆä¸è¶…è¿‡å‰©ä½™èƒå„¿æ•°ï¼‰\n        let births = Math.min(Math.floor(hoursInSecond / inc2), pregnant.length);\n        // å…ˆå–å‡ºå·²ç»ç´¯ç§¯çš„ä¿¡æ¯ï¼ˆé»˜è®¤ç©ºå­—ç¬¦ä¸²ï¼‰\n        let msg = this.getvar(`bf.${female}.notifySecondary`, { defaults: '' });\n\n        // å¦‚æœæ—¶é—´ç´¯ç§¯è¶³å¤Ÿè®©è‡³å°‘ä¸€ä¸ªèƒå„¿å‡ºç”Ÿ\n        if (births > 0) {\n            // ä¾åºå‡ºç”Ÿ\n            for (let i = 0; i < births; i++) {\n                let baby = pregnant.shift();\n                msg += `${female} ç”Ÿä¸‹äº† ${baby.fathers} çš„å­©å­ï¼Œæ€§åˆ¥ç‚º ${baby.gender}\\n`;\n            }\n            // æ›´æ–°å‰©ä½™çš„èƒå„¿åˆ—è¡¨\n            this.setvar(`bf.${female}.pregnant`, pregnant);\n            // å†™å›ç´¯åŠ åçš„å­—ç¬¦ä¸²\n            this.setvar(`bf.${female}.notifySecondary`, msg);\n        }\n\n        if (pregnant.length === 0)  {\n            this.setvar(`bf.${female}`, { stage: 'ç¬¬ä¸‰äº§ç¨‹'}, { merge: true });\n            this.notifyCycle(female, true);\n        }\n        \n    } else if(stage === 'ç¬¬ä¸‰äº§ç¨‹') {\n        // æ€»è€—æ—¶è¾¾åˆ° t3, åˆ†å¨©çµæŸ\n        if (currentStageHours >= t1 + t2 + t3) {\n            this.endPregnancy(female);\n        }\n    }\n});\n-%>",
            "constant": true,
            "vectorized": false,
            "selective": true,
            "selectiveLogic": 0,
            "addMemo": true,
            "order": 10,
            "position": 0,
            "disable": false,
            "excludeRecursion": false,
            "preventRecursion": false,
            "delayUntilRecursion": false,
            "probability": 100,
            "useProbability": true,
            "depth": 4,
            "group": "",
            "groupOverride": false,
            "groupWeight": 100,
            "scanDepth": null,
            "caseSensitive": null,
            "matchWholeWords": null,
            "useGroupScoring": null,
            "automationId": "",
            "role": null,
            "sticky": 0,
            "cooldown": 0,
            "delay": 0,
            "displayIndex": 4,
            "matchPersonaDescription": false,
            "matchCharacterDescription": false,
            "matchCharacterPersonality": false,
            "matchCharacterDepthPrompt": false,
            "matchScenario": false,
            "matchCreatorNotes": false
        },
        "5": {
            "uid": 5,
            "key": [],
            "keysecondary": [],
            "comment": "æ™®é€šçŠ¶æ€(æ²¡æœ‰æ )",
            "content": "<% \nfunction getWeightLevel(fetalBias) {\n    const logValue = Math.log10(fetalBias);\n    if (logValue <= -0.3010) return -3;\n    if (logValue <= -0.2007) return -2;\n    if (logValue <= -0.1003) return -1;\n    if (logValue <= 0.1003) return 0;\n    if (logValue <= 0.2007) return 1;\n    if (logValue <= 0.3010) return 2;\n    return 3;\n}\n\nfunction getWeightLevelText(level) {\n    const levels = {\n        '-3': 'æè½»',\n        '-2': 'è¾ƒè½»',\n        '-1': 'åè½»',\n        '0': 'æ­£å¸¸',\n        '1': 'åé‡',\n        '2': 'è¾ƒé‡',\n        '3': 'æé‡'\n    };\n    return levels[level] || 'æœªçŸ¥';\n}\n%>\n<% for(let char in variables.bf) { %>\n<% if(char && variables.bf[char] && !variables.bf[char].notify) { const data = variables.bf[char]; -%>\nåå­—: <%- char %>, åœ¨å ´:<%- data.isHere%>\n- å½“å‰é˜¶æ®µ: <%- data.stage %>\n- æ€§æ…¾: <%- data.libido %>\n- å®«å£“: <%- Math.round(data.uterinePressure) %>\n<% if(menstrualStage.includes(data.stage)) { -%>\n- ç”Ÿç†æœŸ: <%- data.stage %> (<%- menstrualStage.includes(data.stage) ? (data.eggs > 0 ? 'å±é™©æ—¥' : 'å®‰å…¨æ—¥') : '' %>)\n<% } -%>\n- å®®å†…åµå­<%- data.eggs %>é¡†\n<% if(data.sperms && data.sperms.length > 0) { -%>\n- å®®å†…ç²¾æ¶²(å…±è®¡<%- Math.round(data.sperms.reduce((sum, s) => sum + s.value, 0)) %>ml):\n<% for(let sperm of data.sperms) { if (sperm.value > 0) { -%>\n- <%- sperm.male %>, <%- Math.round(sperm.value) %>ml\n<% } } } -%>\n<% if(pregnancyStage.includes(data.stage) || data.stage === 'äº§å‰é˜µç—›' || laborStage.includes(data.stage)) { -%>\n- å­•æœŸ: ç¬¬<%- Math.floor(data.pregnantDays/7) %>å‘¨ <%- Math.floor(data.pregnantDays%7) %>å¤©\n- èƒå…’æ¶ˆè€—: <%- data.vitalityDrain.toFixed(2) %>\n- å¦Šå¨ å¥åº·: <%- Math.round(data.pregnancyHealth) %>\n<% if(data.pregnant && data.pregnant.length > 0) { -%>\n- èƒå„¿ä¿¡æ¯:\n<% for(let fetus of data.pregnant) { -%>\n* çˆ¶äº²: <%- fetus.fathers %>\n* æ€§åˆ«: <%- fetus.gender %>\n* é¡å‹: <%- fetus.zygoteType %>\n* é«”é‡: <%- getWeightLevelText(getWeightLevel(fetus.fetalBias)) %>\n* èƒä½: <%- fetus.position %>\n* å¿ƒæƒ…: <%- fetus.moodEmoji %>\n<% if(fetus.twinId !== null) { -%>\n* åŒèƒèƒID: <%- fetus.twinId %>\n<% } -%>\n<% } } -%>\n<% } -%>\n\n- æƒ…æ„Ÿä¸æ€§ç»éªŒ:\n<% if(data.virginity === null) { -%>\n- å¤„å¥³: null\n<% } else if(data.virginity) { -%>\n- å¤„å¥³: <%- data.virginity %>\n- æœ€è¿‘æ€§ä¼´: <%- data.latestSexPartner %>\n- æ„Ÿæƒ…ç¶“é©—: <%- data.relationshipExperience|| 0 %>äºº\n- æ€§äº¤ç¶“é©—: <%- data.sexExperience || 0 %>æ¬¡\n- æ€€å­•: <%- data.pregnantExperience || 0 %>æ¬¡\n<% if(data.miscarriageExperience > 0) { -%>\n- æµäº§: <%- data.miscarriageExperience %>æ¬¡\n<% } -%>\n<% } -%>\n<% if(data.mate) { -%>\n- ç¾ä»»ä¼´ä¾£: <%- data.mate %>\n<% } -%>\n<% } } %>",
            "constant": true,
            "vectorized": false,
            "selective": true,
            "selectiveLogic": 0,
            "addMemo": true,
            "order": 300,
            "position": 4,
            "disable": false,
            "excludeRecursion": false,
            "preventRecursion": false,
            "delayUntilRecursion": false,
            "probability": 100,
            "useProbability": true,
            "depth": 0,
            "group": "",
            "groupOverride": false,
            "groupWeight": 100,
            "scanDepth": null,
            "caseSensitive": null,
            "matchWholeWords": null,
            "useGroupScoring": null,
            "automationId": "",
            "role": 0,
            "sticky": 0,
            "cooldown": 0,
            "delay": 0,
            "displayIndex": 5,
            "matchPersonaDescription": false,
            "matchCharacterDescription": false,
            "matchCharacterPersonality": false,
            "matchCharacterDepthPrompt": false,
            "matchScenario": false,
            "matchCreatorNotes": false
        },
        "6": {
            "uid": 6,
            "key": [],
            "keysecondary": [],
            "comment": "å¼ºè°ƒçŠ¶æ€(æ²¡æœ‰æ )",
            "content": "<% for(let char in variables.bf) { if(char && variables.bf[char] && variables.bf[char].notify) { %>\nåå­—: <%- char %>\n- é‡è¦çŠ¶å†µ: <%- variables.bf[char].notify %>\n<% } } %>",
            "constant": true,
            "vectorized": false,
            "selective": true,
            "selectiveLogic": 0,
            "addMemo": true,
            "order": 400,
            "position": 4,
            "disable": false,
            "excludeRecursion": false,
            "preventRecursion": false,
            "delayUntilRecursion": false,
            "probability": 100,
            "useProbability": true,
            "depth": 0,
            "group": "",
            "groupOverride": false,
            "groupWeight": 100,
            "scanDepth": null,
            "caseSensitive": null,
            "matchWholeWords": null,
            "useGroupScoring": null,
            "automationId": "",
            "role": 0,
            "sticky": 0,
            "cooldown": 0,
            "delay": 0,
            "displayIndex": 6,
            "matchPersonaDescription": false,
            "matchCharacterDescription": false,
            "matchCharacterPersonality": false,
            "matchCharacterDepthPrompt": false,
            "matchScenario": false,
            "matchCreatorNotes": false
        },
        "7": {
            "uid": 7,
            "key": [],
            "keysecondary": [],
            "comment": "æŒ‡ä»¤",
            "content": "```\n**æŒ‡ä»¤**\nè€ƒè™‘è°ƒç”¨å‡½æ•°ï¼š\n<% if(!_.isEmpty(variables.bf)) { -%>\nä¸ºä¸Šä¸‹æ–‡æåˆ°çš„é™¤äº†è¿™äº›ä»¥å¤–çš„å¥³æ€§è§’è‰²è®¾ç½®æœˆç»å‘¨æœŸï¼Œä»¥åŠç¬¦åˆå¥¹å€‘èƒŒæ™¯è¨­å®šçš„æƒ…æ„Ÿä¸æ€§ç»éªŒ: <%- _.keys(variables.bf).join(', ') %>ã€‚\n<% } else { -%>\nä¸ºä¸Šä¸‹æ–‡ä¸­æåˆ°çš„æ‰€æœ‰å¥³æ€§è§’è‰²è¨­ç½®æœˆç»å‘¨æœŸ, ä»¥åŠç¬¦åˆå¥¹å€‘èƒŒæ™¯è¨­å®šçš„æƒ…æ„Ÿä¸æ€§ç»éªŒã€‚\n<% } -%>\nåœ¨æ—¶é—´æµé€ã€åœºæ™¯å˜åŒ–ç­‰ä¼šå‘ç”Ÿæ—¶é—´å˜åŒ–çš„æƒ…å†µä¸‹æ—¶åº”å½“è°ƒç”¨**æ—¶é—´æµé€å¤„ç†**å‡½æ•°ï¼Œä¸”é ˆå°é½Š<statustext>ä¸­çš„<time>è¼¸å‡ºè®ŠåŒ–\nè°ƒç”¨å‡½æ•°æ—¶ä¸åº”è¯¥åŒ…å«ä»»ä½•æ³¨é‡Šä¿¡æ¯ã€‚\nä½¿ç”¨ç›¸æ‡‰å‡½æ•¸ï¼Œåˆ¤æ–·å¥³æ€§è§’è‰²æ˜¯å¦åœ¨å ´æ™¯ä¸­ã€‚\nå½“å¥³æ€§è§’è‰²ä½¿ç”¨é˜´é“è¿›è¡Œæ€§äº¤æ—¶å¿…é¡»è°ƒç”¨ç›¸åº”å‡½æ•°ã€‚\næ‡·å­•æ™‚ï¼Œèª¿æ•´emojiä¾†è¡¨ç¾å¯¶å¯¶çš„æƒ…ç·’åæ‡‰ã€‚\né€²å…¥ç¬¬ä¸€/äºŒ/ä¸‰äº§ç¨‹æ™‚æ‰èƒ½ç ´æ°´åˆ†å¨©ï¼Œä¸´äº§æœŸ/é€¾æœŸ/äº§å‰é˜µç—›æ™‚ä¸ç®—é€²å…¥åˆ†å¨©ï¼Œåš´ç¦ç”Ÿç”¢è¡Œç‚º\n```",
            "constant": true,
            "vectorized": false,
            "selective": true,
            "selectiveLogic": 0,
            "addMemo": true,
            "order": 100,
            "position": 4,
            "disable": false,
            "excludeRecursion": false,
            "preventRecursion": false,
            "delayUntilRecursion": false,
            "probability": 100,
            "useProbability": true,
            "depth": 0,
            "group": "",
            "groupOverride": false,
            "groupWeight": 100,
            "scanDepth": null,
            "caseSensitive": null,
            "matchWholeWords": null,
            "useGroupScoring": null,
            "automationId": "",
            "role": 0,
            "sticky": 0,
            "cooldown": 0,
            "delay": 0,
            "displayIndex": 7,
            "matchPersonaDescription": false,
            "matchCharacterDescription": false,
            "matchCharacterPersonality": false,
            "matchCharacterDepthPrompt": false,
            "matchScenario": false,
            "matchCreatorNotes": false
        }
    }
}